#!/bin/bash
# Vulnerability scanning script

set -e

echo "üõ°Ô∏è Starting vulnerability scan..."

# Services to scan
services=("postgresql" "mysql" "redis" "nginx" "mongodb")

for service in "${services[@]}"; do
    echo "üîç Scanning $service..."
    
    # Build image if not exists
    docker build -t "scan-$service" "./$service/" >/dev/null 2>&1 || continue
    
    # Run Trivy scan
    if command -v trivy >/dev/null 2>&1; then
        trivy image --severity HIGH,CRITICAL "scan-$service" || echo "‚ö†Ô∏è  Trivy scan completed with findings"
    else
        echo "‚ö†Ô∏è  Trivy not installed, skipping vulnerability scan"
    fi
done

echo "‚úÖ Vulnerability scan completed!"
